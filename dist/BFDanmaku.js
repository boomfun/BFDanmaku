!function(n){var i={};function r(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=n,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=3)}([function(e,t,n){"use strict";
/*!
 * BFDanmaku.js
 * (c) 2020 BoomFun
 * @license MIT
 */
var i,r,o,s,a,u,c,h;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.StatusType||(t.StatusType={}))[i.stop=0]="stop",i[i.start=1]="start",(r=t.ScrollStatus||(t.ScrollStatus={}))[r.in=0]="in",r[r.roll=1]="roll",r[r.hidden=2]="hidden",(o=t.PoolType||(t.PoolType={}))[o.video=0]="video",o[o.live=1]="live",(s=t.DanmakuStatus||(t.DanmakuStatus={}))[s.show=0]="show",s[s.hidden=1]="hidden",(a=t.AnchorType||(t.AnchorType={}))[a.leftTop=0]="leftTop",a[a.middleTop=1]="middleTop",a[a.rightTop=2]="rightTop",a[a.leftMiddle=3]="leftMiddle",a[a.middle=4]="middle",a[a.rightMiddle=5]="rightMiddle",a[a.leftBottom=6]="leftBottom",a[a.middleBottom=7]="middleBottom",a[a.rightBottom=8]="rightBottom",(u=t.TransitionType||(t.TransitionType={}))[u.none=0]="none",u[u.linear=1]="linear",u[u.easeOutBack=2]="easeOutBack",u[u.easeInBack=3]="easeInBack",u[u.easeInOutBack=4]="easeInOutBack",u[u.easeOutBounce=5]="easeOutBounce",u[u.easeInBounce=6]="easeInBounce",u[u.easeInOutBounce=7]="easeInOutBounce",u[u.easeOutQuad=8]="easeOutQuad",u[u.easeInQuad=9]="easeInQuad",u[u.easeInOutQuad=10]="easeInOutQuad",u[u.easeOutCubic=11]="easeOutCubic",u[u.easeInCubic=12]="easeInCubic",u[u.easeInOutCubic=13]="easeInOutCubic",u[u.easeOutQuart=14]="easeOutQuart",u[u.easeInQuart=15]="easeInQuart",u[u.easeInOutQuart=16]="easeInOutQuart",u[u.easeOutQuint=17]="easeOutQuint",u[u.easeInQuint=18]="easeInQuint",u[u.easeInOutQuint=19]="easeInOutQuint",u[u.easeOutExpo=20]="easeOutExpo",u[u.easeInExpo=21]="easeInExpo",u[u.easeInOutExpo=22]="easeInOutExpo",u[u.easeOutCirc=23]="easeOutCirc",u[u.easeInCirc=24]="easeInCirc",u[u.easeInOutCirc=25]="easeInOutCirc",u[u.easeOutElastic=26]="easeOutElastic",u[u.easeInElastic=27]="easeInElastic",u[u.easeInOutElastic=28]="easeInOutElastic",(c=t.ContentType||(t.ContentType={}))[c.text=0]="text",c[c.base64img=1]="base64img",(h=t.BlendMode||(t.BlendMode={}))[h.normal=0]="normal",h[h.multiply=1]="multiply",h[h.screen=2]="screen",h[h.lighten=3]="lighten",h[h.darken=4]="darken",h[h.difference=5]="difference",h[h.overlay=6]="overlay",h[h.hardlight=7]="hardlight",h[h.softlight=8]="softlight",h[h.color=9]="color",h[h.colordodg=10]="colordodg",h[h.colorburn=11]="colorburn",h[h.exclusion=12]="exclusion",h[h.hue=13]="hue",h[h.saturation=14]="saturation",h[h.luminosity=15]="luminosity"},function(e,t,n){"use strict";var i,r;Object.defineProperty(t,"__esModule",{value:!0}),(r=i=t.ColorType||(t.ColorType={}))[r.HEX=0]="HEX",r[r.DEC=1]="DEC",r[r.RGB=2]="RGB";var o=(s.prototype.toString=function(e,t){switch(void 0===e&&(e=i.RGB),void 0===t&&(t=!1),e){case i.DEC:return parseInt(this.a.toString(16));case i.HEX:return this.r.toString(16)+this.g.toString(16)+this.b.toString(16)+t?this.a.toString(16):"";case i.RGB:default:return(t?"RGBA":"RGB")+"("+this.r+","+this.g+","+this.b+(t?","+this.a/255:"")+")"}},s.getInstanceFromHEX=function(e){for(var t=(e=e.replace("#","")).length,n=0;n<6-t;n++)e="0"+e;return 7==e.length&&(e="0"+e),new s(e)},s.getInstanceFromDEC=function(e){return this.getInstanceFromHEX(e.toString(16))},s.getInstanceFromRGB=function(e,t,n,i){var r=new s("");return r.r=null!=e?e:255,r.g=null!=t?t:255,r.b=null!=n?n:255,r.a=null!=i?i:255,r},s);function s(e){this.r=255,this.g=255,this.b=255,this.a=255,""!=e&&(this.r=parseInt("0x"+e[0]+e[1]),this.g=parseInt("0x"+e[2]+e[3]),this.b=parseInt("0x"+e[4]+e[5]),void 0!==e[6]&&(this.a=parseInt("0x"+e[6]+e[7])),NaN==this.r||this.r,NaN==this.g||this.g,NaN==this.b||this.b,NaN==this.a||this.a)}t.Color=o},function(e,t,n){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var r,o;(o=r=r||{})[o.log=0]="log",o[o.info=1]="info",o[o.warn=2]="warn",o[o.error=3]="error";var s=(a.devModeTriggle=function(e){this.devmode=void 0!==e?e:!this.devmode},a._log=function(e,t){var n;switch(e){case r.info:n=console.info;break;case r.warn:n=console.warn;break;case r.error:n=console.error;break;default:n=console.log}n.apply(void 0,i(["[BFDanmaku]"],t))},a.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.devmode&&this._log(r.info,e)},a.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.devmode&&this._log(r.log,e)},a.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.devmode&&this._log(r.warn,e)},a.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._log(r.error,e)},a.devmode=!1,a);function a(){}t.Log=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(8),o=n(1);window.DanmakuPool=i.DanmakuPool,window.DanmakuStage=r.DanmakuStage,window.DanmakuColor=o.Color},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=n(2),i=(s.prototype.bindRenderEngine=function(e){this.renderEngine=e},s.prototype.searchRange=function(e,t){for(var n=[],i=Math.floor(e/1e3),r=e%1e3,o=Math.floor(t/1e3),s=t%1e3,a=0;a<this.secondTime.length;a++){var u=Number(this.secondTime[a]);if(i<=u&&u<=o)for(var c=Object.keys(this.timeTable[u+""]),h=0;h<c.length;h++){var d=Number(c[h]);if((u!=i||r<=d)&&(u!=o||d<=s))for(var l=0;l<this.timeTable[u+""][d+""].length;l++)n.push(this.timeTable[u+""][d+""][l])}else if(o<u)break}return n},s.prototype.push=function(e){if(void 0!==this.renderEngine){var t=new r.DanmakuObject(e,this.renderEngine),n=""+Math.floor(e.startTime/1e3),i=""+e.startTime%1e3;return this.timeTable[n]||(this.timeTable[n]={},this.insertSecond(n)),this.timeTable[n][i]||(this.timeTable[n][i]=[]),this.timeTable[n][i].push(t),t}o.Log.error("DanmakuPool require binding DanmakuStage before using it.")},s.prototype.insertSecond=function(e){for(var t=0;t<this.secondTime.length;t++){var n=this.secondTime[t];if(Number(n)>Number(e))return void this.secondTime.splice(t,0,e)}this.secondTime.push(e)},s);function s(){this.timeTable={},this.secondTime=[]}t.DanmakuPool=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(0),o=n(7),s=n(1),a=(u.prototype.show=function(e,t){return!!this.enable&&(e>this.hiddenTime||e<this.startTime?(this.seekTimes=t,this.needRendering=!1,this.renderEngine.remove(this.dom),this.reloadRenderConfig(),!1):(this.seekTimes!==t&&this.needRendering?this.reloadRenderConfig():this.needRendering=!0,this.seekTimes=t,this.calculate(e),this.renderEngine.draw(this.renderConfig,this.dom),!0))},u.prototype.enableTriggle=function(e){this.enable=void 0!==e?e:!this.enable},u.prototype.calculate=function(e){var t=e-this.startTime;if(!(t<=0))for(var n=this.config.frames[0==this.frameIndex?0:this.frameIndex-1],i=this.frameIndex;i<this.config.frames.length;i++){var r=this.config.frames[i];if(!(this.currentCalcTime+r.time<=t)){this.frameIndex=i,this.setFrameStyle(n,r,t-this.currentCalcTime,r.time);break}this.currentCalcTime+=r.time,this.setFrameStyleEqual(r),n=r}},u.prototype.setFrameStyle=function(e,t,n,i){var r=o.Easing.getEasingFunc(t.transition);this.renderConfig.x=this.diff(e.point.x,t.point.x,r,n,i),this.renderConfig.y=this.diff(e.point.y,t.point.y,r,n,i),this.renderConfig.z=this.diff(e.point.z,t.point.z,r,n,i),this.diffColor(this.renderConfig.color,r,e.color,t.color,n,i),this.renderConfig.opacity=this.diff(e.opacity,t.opacity,r,n,i),this.renderConfig.rotateX=this.diff(e.rotate.x,t.rotate.x,r,n,i),this.renderConfig.rotateY=this.diff(e.rotate.y,t.rotate.y,r,n,i),this.renderConfig.rotateZ=this.diff(e.rotate.z,t.rotate.z,r,n,i),this.renderConfig.scaleX=this.diff(e.scale.x,t.scale.x,r,n,i),this.renderConfig.scaleY=this.diff(e.scale.y,t.scale.y,r,n,i),this.renderConfig.scaleZ=this.diff(e.scale.z,t.scale.z,r,n,i)},u.prototype.setFrameStyleEqual=function(e){this.renderConfig.x=e.point.x,this.renderConfig.y=e.point.y,this.renderConfig.z=e.point.z,this.renderConfig.color.a=e.color.a,this.renderConfig.color.r=e.color.r,this.renderConfig.color.g=e.color.g,this.renderConfig.color.b=e.color.b,this.renderConfig.opacity=e.opacity,this.renderConfig.rotateX=e.rotate.x,this.renderConfig.rotateY=e.rotate.y,this.renderConfig.rotateZ=e.rotate.z,this.renderConfig.scaleX=e.scale.x,this.renderConfig.scaleY=e.scale.y,this.renderConfig.scaleZ=e.scale.z},u.prototype.diff=function(e,t,n,i,r){return t==e?e:e+n(i,t-e,r)},u.prototype.diffColor=function(e,t,n,i,r,o){if(n.r!=i.r||n.g!=i.g||n.b!=i.b||n.a!=i.a){var s=e;s.r=n.r+t(r,i.r-n.r,o),s.g=n.g+t(r,i.g-n.g,o),s.b=n.b+t(r,i.b-n.b,o),s.a=n.a+t(r,i.a-n.a,o)}},u.prototype.init=function(){var e=this.config;if(this.renderInitConfig={size:e.word.size,anchor:e.anchor,font:e.word.font,bold:e.word.bold,stroke:e.word.stroke,filter:e.filter,contentType:e.contentType,zindex:e.zindex,fontScale:1,bm:e.bm},this.reloadRenderConfig(),this.config.contentType==r.ContentType.base64img)this.dom=document.createElement("img"),this.dom.src="data:image/png;base64,"+this.config.content,this.dom.content="image";else{var t=e.content.replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;");"&nbsp;"==t&&(t=""),this.dom=document.createElement("div"),e.filter&&this.dom.setAttribute("data-content",e.content.replace(/\r\n/g,"\n")),this.dom.innerHTML=t,this.dom.content=t,this.fixContentAreaOffset(e.word.font,t)}this.dom.id=this.config.id,this.renderEngine.setInitStyle(this.renderInitConfig,this.dom),this.renderConfig.fontScale=this.renderInitConfig.fontScale,this.renderConfig.size=this.renderInitConfig.size,this.setTimePoint(),this.dom.danmakuConfig=e,this.dom.danmakuRenderConfig=this.renderConfig,this.dom.danmakuRenderInitConfig=this.renderInitConfig},u.prototype.reloadRenderConfig=function(){if(this.renderConfig){var e=this.renderConfig.fixTop,t=this.renderConfig.fontScale,n=this.renderConfig.size;this.renderConfig=Object.assign({},i.DefaultRenderConfig),this.renderConfig.fixTop=e,this.renderConfig.fontScale=t,this.renderConfig.size=n}else this.renderConfig=Object.assign({},i.DefaultRenderConfig);this.renderConfig.color=s.Color.getInstanceFromRGB(255,255,255,255),this.setFrameStyleEqual(this.config.frames[0]),this.renderConfig.anchor=this.config.anchor,this.renderConfig.zindex=this.config.zindex,this.renderConfig.parent=this.config.parent,this.renderConfig.mask=this.config.mask,this.renderConfig.contentType=this.config.contentType,this.frameIndex=0,this.currentCalcTime=0},u.prototype.fixContentAreaOffset=function(e,t){if("微软雅黑"==e||"Microsoft YaHei"==e){if("●"==t||"■"==t)return void(this.renderConfig.fixTop=.09);this.renderConfig.fixTop=.06}},u.prototype.setTimePoint=function(){this.startTime=this.config.startTime;for(var e=0,t=0,n=this.config.frames;t<n.length;t++)e+=n[t].time;this.hiddenTime=this.startTime+e},u);function u(e,t){this.seekTimes=0,this.frameIndex=0,this.needRendering=!1,this.enable=!0,this.config=e,this.renderEngine=t,this.init()}t.DanmakuObject=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0);t.DefaultRenderConfig={x:0,y:0,z:0,opacity:1,color:i.Color.getInstanceFromRGB(255,255,255,255),rotateX:0,rotateY:0,rotateZ:0,scaleX:1,scaleY:1,scaleZ:1,anchor:r.AnchorType.middle,contentType:r.ContentType.text,fontScale:1,zindex:0,size:25}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=(s.getEasingFunc=function(e){switch(e){case i.TransitionType.none:return s.none;case i.TransitionType.linear:return s.linear;case i.TransitionType.easeOutBack:return s.easeOutBack;case i.TransitionType.easeInBack:return s.easeInBack;case i.TransitionType.easeInOutBack:return s.easeInOutBack;case i.TransitionType.easeOutBounce:return s.easeOutBounce;case i.TransitionType.easeInBounce:return s.easeInBack;case i.TransitionType.easeInOutBounce:return s.easeInOutBounce;case i.TransitionType.easeInQuad:return s.easeInQuad;case i.TransitionType.easeOutQuad:return s.easeOutQuad;case i.TransitionType.easeInOutQuad:return s.easeInOutQuad;case i.TransitionType.easeOutCubic:return s.easeOutCubic;case i.TransitionType.easeInCubic:return s.easeInCubic;case i.TransitionType.easeInOutCubic:return s.easeInOutCubic;case i.TransitionType.easeOutQuart:return s.easeOutQuart;case i.TransitionType.easeInQuart:return s.easeInQuart;case i.TransitionType.easeInOutQuart:return s.easeInOutQuart;case i.TransitionType.easeOutQuint:return s.easeOutQuint;case i.TransitionType.easeInQuint:return s.easeInQuint;case i.TransitionType.easeInOutQuint:return s.easeInOutQuint;case i.TransitionType.easeOutExpo:return s.easeOutExpo;case i.TransitionType.easeInExpo:return s.easeInExpo;case i.TransitionType.easeInOutExpo:return s.easeInOutExpo;case i.TransitionType.easeOutCirc:return s.easeOutCirc;case i.TransitionType.easeInCirc:return s.easeInCirc;case i.TransitionType.easeInOutCirc:return s.easeInOutCirc;case i.TransitionType.easeOutElastic:return s.easeOutElastic;case i.TransitionType.easeInElastic:return s.easeInElastic;case i.TransitionType.easeInOutElastic:return s.easeInOutElastic;default:return r.Log.warn("Unexpected easing function type:"+e),s.linear}},s.none=function(e,t,n){return t},s.linear=function(e,t,n){return a.Linear(e,0,t,n)},s.easeInBack=function(e,t,n){return a.Back.easeIn(e,0,t,n,void 0)},s.easeOutBack=function(e,t,n){return a.Back.easeOut(e,0,t,n,void 0)},s.easeInOutBack=function(e,t,n){return a.Back.easeInOut(e,0,t,n,void 0)},s.easeInBounce=function(e,t,n){return a.Bounce.easeIn(e,0,t,n)},s.easeOutBounce=function(e,t,n){return a.Bounce.easeOut(e,0,t,n)},s.easeInOutBounce=function(e,t,n){return a.Bounce.easeInOut(e,0,t,n)},s.easeInQuad=function(e,t,n){return a.Quad.easeIn(e,0,t,n)},s.easeOutQuad=function(e,t,n){return a.Quad.easeOut(e,0,t,n)},s.easeInOutQuad=function(e,t,n){return a.Quad.easeInOut(e,0,t,n)},s.easeInCubic=function(e,t,n){return a.Cubic.easeIn(e,0,t,n)},s.easeOutCubic=function(e,t,n){return a.Cubic.easeOut(e,0,t,n)},s.easeInOutCubic=function(e,t,n){return a.Cubic.easeInOut(e,0,t,n)},s.easeInQuart=function(e,t,n){return a.Quart.easeIn(e,0,t,n)},s.easeOutQuart=function(e,t,n){return a.Quart.easeOut(e,0,t,n)},s.easeInOutQuart=function(e,t,n){return a.Quart.easeInOut(e,0,t,n)},s.easeInQuint=function(e,t,n){return a.Quint.easeIn(e,0,t,n)},s.easeOutQuint=function(e,t,n){return a.Quint.easeOut(e,0,t,n)},s.easeInOutQuint=function(e,t,n){return a.Quint.easeInOut(e,0,t,n)},s.easeInExpo=function(e,t,n){return a.Expo.easeIn(e,0,t,n)},s.easeOutExpo=function(e,t,n){return a.Expo.easeOut(e,0,t,n)},s.easeInOutExpo=function(e,t,n){return a.Expo.easeInOut(e,0,t,n)},s.easeInCirc=function(e,t,n){return a.Circ.easeIn(e,0,t,n)},s.easeOutCirc=function(e,t,n){return a.Circ.easeOut(e,0,t,n)},s.easeInOutCirc=function(e,t,n){return a.Circ.easeInOut(e,0,t,n)},s.easeInElastic=function(e,t,n){return a.Elastic.easeIn(e,0,t,n,void 0,void 0)},s.easeOutElastic=function(e,t,n){return a.Elastic.easeOut(e,0,t,n,void 0,void 0)},s.easeInOutElastic=function(e,t,n){return a.Elastic.easeInOut(e,0,t,n,void 0,void 0)},s);function s(){}t.Easing=o;var a={Linear:function(e,t,n,i){return n*e/i+t},Quad:{easeIn:function(e,t,n,i){return n*(e/=i)*e+t},easeOut:function(e,t,n,i){return-n*(e/=i)*(e-2)+t},easeInOut:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}},Cubic:{easeIn:function(e,t,n,i){return n*(e/=i)*e*e+t},easeOut:function(e,t,n,i){return n*((e=e/i-1)*e*e+1)+t},easeInOut:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}},Quart:{easeIn:function(e,t,n,i){return n*(e/=i)*e*e*e+t},easeOut:function(e,t,n,i){return-n*((e=e/i-1)*e*e*e-1)+t},easeInOut:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}},Quint:{easeIn:function(e,t,n,i){return n*(e/=i)*e*e*e*e+t},easeOut:function(e,t,n,i){return n*((e=e/i-1)*e*e*e*e+1)+t},easeInOut:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t}},Sine:{easeIn:function(e,t,n,i){return-n*Math.cos(e/i*(Math.PI/2))+n+t},easeOut:function(e,t,n,i){return n*Math.sin(e/i*(Math.PI/2))+t},easeInOut:function(e,t,n,i){return-n/2*(Math.cos(Math.PI*e/i)-1)+t}},Expo:{easeIn:function(e,t,n,i){return 0==e?t:n*Math.pow(2,10*(e/i-1))+t},easeOut:function(e,t,n,i){return e==i?t+n:n*(1-Math.pow(2,-10*e/i))+t},easeInOut:function(e,t,n,i){return 0==e?t:e==i?t+n:(e/=i/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(2-Math.pow(2,-10*--e))+t}},Circ:{easeIn:function(e,t,n,i){return-n*(Math.sqrt(1-(e/=i)*e)-1)+t},easeOut:function(e,t,n,i){return n*Math.sqrt(1-(e=e/i-1)*e)+t},easeInOut:function(e,t,n,i){return(e/=i/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}},Elastic:{easeIn:function(e,t,n,i,r,o){var s;return 0==e?t:1==(e/=i)?t+n:(void 0===o&&(o=.3*i),!r||r<Math.abs(n)?(s=o/4,r=n):s=o/(2*Math.PI)*Math.asin(n/r),-(r*Math.pow(2,10*--e)*Math.sin((e*i-s)*(2*Math.PI)/o))+t)},easeOut:function(e,t,n,i,r,o){var s;return 0==e?t:1==(e/=i)?t+n:(void 0===o&&(o=.3*i),s=!r||r<Math.abs(n)?(r=n,o/4):o/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*e)*Math.sin((e*i-s)*(2*Math.PI)/o)+n+t)},easeInOut:function(e,t,n,i,r,o){var s;return 0==e?t:2==(e/=i/2)?t+n:(void 0===o&&(o=i*(.3*1.5)),s=!r||r<Math.abs(n)?(r=n,o/4):o/(2*Math.PI)*Math.asin(n/r),e<1?r*Math.pow(2,10*--e)*Math.sin((e*i-s)*(2*Math.PI)/o)*-.5+t:r*Math.pow(2,-10*--e)*Math.sin((e*i-s)*(2*Math.PI)/o)*.5+n+t)}},Back:{easeIn:function(e,t,n,i,r){return void 0===r&&(r=1.70158),n*(e/=i)*e*((r+1)*e-r)+t},easeOut:function(e,t,n,i,r){return void 0===r&&(r=1.70158),n*((e=e/i-1)*e*((r+1)*e+r)+1)+t},easeInOut:function(e,t,n,i,r){return void 0===r&&(r=1.70158),(e/=i/2)<1?n/2*(e*e*((1+(r*=1.525))*e-r))+t:n/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t}},Bounce:{easeIn:function(e,t,n,i){return n-a.Bounce.easeOut(i-e,0,n,i)+t},easeOut:function(e,t,n,i){return(e/=i)<1/2.75?n*(7.5625*e*e)+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOut:function(e,t,n,i){return e<i/2?.5*a.Bounce.easeIn(2*e,0,n,i)+t:.5*a.Bounce.easeOut(2*e-i,0,n,i)+.5*n+t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),u=n(10),c=n(2),h=n(12),i=(r.prototype.start=function(){this.timer.start()},r.prototype.stop=function(){this.timer.stop()},r.prototype.seek=function(e){this.seekTimes++,this.fix(e)},r.prototype.fix=function(e){this.timer.setTime(e)},r.prototype.watchConfig=function(){function e(t){var n=r.config[t];r.config.hasOwnProperty(t)&&Object.defineProperty(r.config,t,{get:function(){return n},set:function(e){switch(c.Log.log("Watcher",t,e,n),n=e,t){case"width":case"height":i.renderEngine.resize(i.config.width,i.config.height);break;case"dev":c.Log.devModeTriggle(e);break;case"opacity":i.renderEngine.opacity(e);break;case"font":i.renderEngine.font(e);break;case"font":i.renderEngine.performanceModeTriggle(e)}},enumerable:!0,configurable:!0})}var i=this,r=this;for(var t in this.config)e(t)},r.prototype.tick=function(t){var e;if(t<this.time)this.time=t;else{this.config.hooks.beforeTick&&this.config.hooks.beforeTick(this.time,t),this.renderEngine.beforeTick();var n=this.pool.searchRange(this.time,t);(e=this.stageList).push.apply(e,n);for(var i=0;i<this.stageList.length;i++){var r=this.stageList[i];try{r.show(t,this.seekTimes)||this.stageList.splice(i--,1)}catch(e){c.Log.error("tick",this.time,t,e)}}this.time=t,this.renderEngine.afterTick(),this.config.hooks.afterTick&&this.config.hooks.afterTick(this.time,t)}},r);function r(e,t,n,i,r){var o=this;this.config=Object.assign({},a.DefaultStageConfig),this.stageList=[],this.seekTimes=0,this.time=0,this.pool=t,this.config=r?Object.assign(r,a.DefaultStageConfig):Object.assign({},a.DefaultStageConfig),r.width&&r.height||(r.width=e.clientWidth,r.height=e.clientHeight),r.dev&&c.Log.devModeTriggle(),c.Log.log("video size：",n,i);var s=r.baseWidth?r.baseWidth:1280;i=i/n*s,n=s,c.Log.log("render size：",n,i),this.renderEngine=new u.RenderEngine(e,n,i,r.width,r.height),this.renderEngine.opacity(r.opacity),this.renderEngine.font(r.font),this.timer=new h.Timer(function(e){o.tick(e)}),t.bindRenderEngine(this.renderEngine),!1===r.performanceMode&&this.renderEngine.performanceModeTriggle(!1),this.watchConfig()}t.DanmakuStage=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultStageConfig={opacity:1,font:"SimHei",hooks:{}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=n(0),d=n(1),l=n(11),f=n(2),i=(r.prototype.resize=function(e,t){this.stage.style.transform="scale("+e/this.videoWidth+","+t/this.videoHeight},r.prototype.opacity=function(e){this.stage.style.opacity=e+""},r.prototype.font=function(e){this.stage.style.fontFamily=e},r.prototype.performanceModeTriggle=function(e){this.performanceMode=void 0!==e?e:!this.performanceMode,this.performanceMode&&this.stage.classList.remove("bfdanmaku-nofilter")},r.prototype.draw=function(e,t){var n=t.id,i=this.onStageList[n],r={dom:t,style:this.setDiffStyle(e,t),editZ:!(0==e.z&&0==e.rotateX&&!e.rotateY)};if(void 0===i&&(this.onStageList[n]=t,e.parent?r.append=e.parent:r.append="stage",e.mask&&this.onStageList[e.mask])){var o=this.onStageList[e.mask];o.style.display="none";var s=+o.style.zIndex;e.zindex=e.zindex<s?s:e.zindex+1,t.style.zIndex=e.zindex+""}this.renderQueue.push(r)},r.prototype.beforeTick=function(){this.renderQueue=[]},r.prototype.afterTick=function(){this.render()},r.prototype.remove=function(e){var t=e.id;e.remove(),delete this.onStageList[t]},r.prototype.setInitStyle=function(e,t){if(e.contentType==h.ContentType.text){for(var n=1,i=e.size*this.ratioScale;i<12;)i*=2,n*=.5;if(e.size=i,e.fontScale=n,this.setStyle(["font-size",i+"px"],t),this.setStyle(["white-space","nowrap"],t),e.bold&&this.setStyle(["font-weight","bold"],t),e.stroke&&(this.setStyle(["text-stroke","0.3px #a3a3a3"],t),this.setStyle(["-webkit-text-stroke","0.3px #a3a3a3"],t)),e.font&&this.setStyle(["font-family",e.font],t),e.filter)for(var r=0,o=e.filter;r<o.length;r++){var s=o[r];switch(s.type){case l.FilterType.TextShadow:var a=s,u=a.color.toString(d.ColorType.RGB,!0)+" "+a.offsetX+"px "+a.offsetY+"px "+a.blur+"px";this.setStyle(["text-shadow",u],t),this.setStyle(["-webkit-text-shadow",u],t),a.knockout&&t.classList.add("bfdanmaku-knockout"),a.onlyShadow&&(u="transparent",this.setStyle(["text-fill-color",u],t),this.setStyle(["-webkit-text-fill-color",u],t));break;case l.FilterType.blur:this.setStyle(["filter","blur("+s.blur+"px)"],t);break;default:f.Log.warn("Unexpected filter type:"+s.type)}}}if(this.setStyle(["position","absolute"],t),this.setStyle(["transform-origin",this.getOrigin(e.anchor)],t),e.bm){var c=void 0;switch(e.bm){case h.BlendMode.darken:c="darken";break;case h.BlendMode.difference:c="difference";break;case h.BlendMode.hardlight:c="hard-light";break;case h.BlendMode.lighten:c="lighten";break;case h.BlendMode.multiply:c="multiply";break;case h.BlendMode.overlay:c="overlay";break;case h.BlendMode.screen:c="screen";break;case h.BlendMode.softlight:c="soft-light";break;case h.BlendMode.color:c="color";break;case h.BlendMode.colordodg:c="color-dodg";break;case h.BlendMode.colorburn:c="color-burn";break;case h.BlendMode.exclusion:c="exclusion";break;case h.BlendMode.hue:c="hue";break;case h.BlendMode.saturation:c="saturation";break;case h.BlendMode.luminosity:c="luminosity";break;default:f.Log.warn("Unexpected blend mode:"+e.bm)}c&&this.setStyle(["mix-blend-mode",c],t)}this.setStyle(["transform-style","preserve-3d"],t),this.setStyle(["z-index",e.zindex],t)},r.prototype.setDiffStyle=function(e,t){var n=[],i=e.x*this.ratioX,r=e.y*this.ratioY;if(void 0!==e.parent&&null!=this.onStageList[e.parent]){var o=0<i?"+ "+i:"- "+-1*i,s=0<r?"+ "+r:"- "+-1*r;n.push(["left","calc("+this.getAlignValue(e.anchor,!0)+" "+o+"px)"]),n.push(["top","calc("+this.getBaselineValue(e.anchor,!0)+" "+s+"px)"])}else n.push(["left",i+"px"]),n.push(["top",r+"px"]);var a=1;e.contentType==h.ContentType.base64img&&(a=this.ratioScale,e.fontScale=1);var u=e.scaleY*e.fontScale*a,c=e.scaleX*e.fontScale*a;return t.isParent||(u*=this.ratioX,c*=this.ratioX),n.push(["transform","translate("+this.getAlignValue(e.anchor)+","+this.getBaselineValue(e.anchor)+") translateZ("+e.z+"px) rotateX("+e.rotateX+"deg) rotateY("+e.rotateY+"deg) rotateZ("+e.rotateZ+"deg) scaleX("+c+") scaleY("+u+") scaleZ("+e.scaleZ+")"]),n.push(["opacity",e.opacity]),n.push(["color",e.color.toString(d.ColorType.RGB,!0)]),e.fixTop&&n.push(["margin-top","-"+e.fixTop*u*e.size*this.ratioScale+"px"]),n},r.prototype.render=function(){for(var e=!1,t=0,n=this.renderQueue;t<n.length;t++){var i=n[t];i.editZ&&!e&&(e=!0);for(var r=i.dom,o=0,s=i.style;o<s.length;o++){var a=s[o];this.setStyle(a,r)}if(i.append)if("stage"==i.append)this.stage.append(r);else{var u=this.onStageList[i.append];u?(u.style.display="block",u.append(r),u.isParent=!0):this.stage.append(r)}}e?(this.stage.style.perspective="1000px",this.performanceMode&&this.stage.classList.add("bfdanmaku-nofilter")):(this.stage.style.perspective="unset",this.performanceMode&&this.stage.classList.remove("bfdanmaku-nofilter"))},r.prototype.setStyle=function(e,t){t.style[e[0]]=e[1]},r.prototype.getBaselineValue=function(e,t){switch(e){case h.AnchorType.leftBottom:case h.AnchorType.rightBottom:case h.AnchorType.middleBottom:return t?"100%":"-100%";case h.AnchorType.middle:case h.AnchorType.leftMiddle:case h.AnchorType.rightMiddle:return t?"50%":"-50%";default:return 0}},r.prototype.getAlignValue=function(e,t){switch(e){case h.AnchorType.rightBottom:case h.AnchorType.rightMiddle:case h.AnchorType.rightTop:return t?"100%":"-100%";case h.AnchorType.middle:case h.AnchorType.middleBottom:case h.AnchorType.middleTop:return t?"50%":"-50%";default:return 0}},r.prototype.getOrigin=function(e){var t="";switch(e){case h.AnchorType.leftBottom:case h.AnchorType.rightBottom:case h.AnchorType.middleBottom:t+="bottom ";break;case h.AnchorType.middle:case h.AnchorType.leftMiddle:case h.AnchorType.rightMiddle:t+="center ";break;default:t+="top "}switch(e){case h.AnchorType.rightBottom:case h.AnchorType.rightMiddle:case h.AnchorType.rightTop:t+="right";break;case h.AnchorType.middle:case h.AnchorType.middleBottom:case h.AnchorType.middleTop:t+="center";break;default:t+="left"}return t},r);function r(e,t,n,i,r){this.onStageList={},this.ratioX=1,this.ratioY=1,this.ratioScale=1,this.performanceMode=!0,this.videoHeight=n,this.videoWidth=t,this.ratioX=t/1e3,this.ratioY=n/1e3,this.ratioScale=this.ratioX*this.ratioY*this.ratioX,this.stage=document.createElement("div"),this.stage.classList.add("bfdanmaku-stage"),this.stage.style.cssText="transform:scale("+i/t+","+r/n+");width:"+t+"px;height:"+n+"px;",e.append(this.stage);var o=document.createElement("style");o.appendChild(document.createTextNode("")),document.head.appendChild(o),this.sheet=o.sheet,this.sheet.insertRule(".bfdanmaku-knockout::after {content: attr(data-content);position: absolute;left: 0;top: 0;white-space: pre-line;}"),this.sheet.insertRule(".bfdanmaku-knockout,.bfdanmaku-knockout::after {mix-blend-mode: lighten !important;}"),this.sheet.insertRule(".bfdanmaku-knockout{color: black !important;}"),this.sheet.insertRule(".bfdanmaku-stage{transform-origin:left top;position:relative;z-index:0;top:0;left:0;line-height:1;overflow:hidden;}"),this.sheet.insertRule(".bfdanmaku-stage span{display: inline-block;}"),this.sheet.insertRule(".bfdanmaku-nofilter *{filter: none !important;text-shadow: none !important;-webkit-text-stroke: 0 !important;}")}t.RenderEngine=i},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.FilterType||(t.FilterType={}))[i.TextShadow=0]="TextShadow",i[i.blur=1]="blur"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=(o.prototype.tick=function(e){-1!=this.time?(this.deltaTime+=e-this.time,this.time=e,this.callback(this.deltaTime)):this.time=e},o.prototype.setStatus=function(e){(this.status=e)==i.StatusType.stop&&(this.time=-1)},o.prototype.reset=function(){this.time=-1,this.deltaTime=0},o.prototype.setTime=function(e){this.deltaTime=e},o.prototype.start=function(){var t=this,n=function(e){t.status==i.StatusType.start&&(t.tick(e),window.requestAnimationFrame(n))};window.requestAnimationFrame(n),this.setStatus(i.StatusType.start)},o.prototype.stop=function(){this.setStatus(i.StatusType.stop)},o);function o(e){this.time=-1,this.deltaTime=0,this.callback=e}t.Timer=r}]);